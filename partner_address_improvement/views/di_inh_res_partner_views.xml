<?xml version="1.0" encoding="UTF-8"?>
<odoo>
	<!-- ajout filtre sur les type de tiers pour masquer les adresses et contacts -->
    <record id="di_view_res_partner_filter" model="ir.ui.view">
        <field name="name">di.res.partner.select</field>
        <field name="model">res.partner</field>
        <field name="inherit_id" ref="base.view_res_partner_filter"/>
        <field eval="80" name="priority"/>
        <field name="arch" type="xml">
            <!-- ajout coche adresse par défaut -->
            <xpath expr="//search/field[@name='name']" position="after">
               <filter name="di_filter_parent_partner" help="Parent Partner" string="Parent Partner"
                       domain="[('parent_id','=', False)]"/>
            </xpath>                
        </field>
    </record>
    <record id="account.res_partner_action_customer" model="ir.actions.act_window"><!-- standard + ajout filtre dans contexte -->
        <field name="name">Customers</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">res.partner</field>
        <field name="view_mode">kanban,tree,form</field>
        <field name="context">{'search_default_customer': 1,'res_partner_search_mode': 'customer', 'default_is_company': True,
        						'default_customer_rank': 1, 'search_default_di_filter_parent_partner': 1}
        </field>
        <field name="help" type="html">
          <p class="o_view_nocontent_smiling_face">
            Create a new customer in your address book
          </p><p>
            Odoo helps you easily track all activities related to a customer.
          </p>
        </field>
    </record>
    <record id="account.res_partner_action_supplier" model="ir.actions.act_window"><!-- standard + ajout filtre dans contexte -->
        <field name="name">Vendors</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">res.partner</field>
        <field name="view_mode">kanban,tree,form</field>
        <field name="context">{'search_default_supplier': 1,'res_partner_search_mode': 'supplier', 'default_is_company': True,
        						'default_supplier_rank': 1, 'search_default_di_filter_parent_partner': 1}
        </field>
        <field name="help" type="html">
          <p class="o_view_nocontent_smiling_face">
            Create a new supplier in your address book
          </p><p>
            Odoo helps you easily track all activities related to a supplier.
          </p>
        </field>
    </record>        
    <!-- surcharge du formulaire - Commun Clients/Fournisseurs -->
    <record id="di_view_partner_form" model="ir.ui.view">
        <field name="name">di.res.partner.form</field>
        <field name="model">res.partner</field>
        <field name="inherit_id" ref="base.view_partner_form"/>
        <field eval="80" name="priority"/>
        <field name="arch" type="xml">
            <!-- modification affichage contacts/adresses (kanban - on ajoute le champ dans le kanban et on le positionne) -->
            <xpath
                expr="//field[@name='child_ids']/kanban/field[@name='name']" position="after">
                <field name="di_default_address"/>
            </xpath>
            <xpath
                expr="//field[@name='child_ids']/kanban/templates/t/div/div[2]" position="inside">
                <t t-if="record.type.raw_value != 'contact'">
                    <i class="fa fa-check" t-if="record.di_default_address.raw_value " title="Default address"/>
                </t>
            </xpath>
            <!-- ajout coche adresse par défaut -->
            <xpath
                expr="//notebook/page/field/form/sheet/field[@name='type']" position="after">
                <p/>
                <label
                    attrs="{'invisible':[('type', '!=', 'delivery'),('type', '!=', 'invoice')]}" for="di_default_address"/>
                <field
                    attrs="{'invisible':[('type', '!=', 'delivery'),('type', '!=', 'invoice')]}" name="di_default_address"/>
            </xpath>
            <!-- masquage champ état + modif place ville/code postal dans le formulaire contact/adresse -->
            <xpath expr="//div[@name='div_address']" position="replace">
              <div class="o_address_format" name="div_address"><!-- reprise du standard  -->
              	  <field name="di_company_country_code" attrs="{'invisible': 1 }"/>
                  <field name="street" placeholder="Street..." class="o_address_street"/>
                  <field name="street2" placeholder="Street 2..." class="o_address_street"/>
                  <field name="zip" placeholder="ZIP" class="o_address_zip" attrs="{'invisible': [('di_company_country_code','!=', 'FR')]}"/>
                  <field name="city" placeholder="City" class="o_address_city"/>
                  <field name="state_id" class="o_address_state" placeholder="State" options="{'no_open': True, 'no_quick_create': True}"
                  	context="{'country_id': country_id, 'default_country_id': country_id, 'zip': zip}"
                  	attrs="{'invisible': [('di_company_country_code','=', 'FR')]}"
                  />
                  <field name="zip" placeholder="ZIP" class="o_address_zip" attrs="{'invisible': [('di_company_country_code','=', 'FR')]}"/>
                  <field name="country_id" placeholder="Country" class="o_address_country" options='{"no_open": True, "no_create": True}'/>
              </div>
            </xpath>
            <!-- masquage champ état + modif place ville/code postal dans le formulaire principal -->
            <xpath expr="//sheet/group/group/div" position="replace">
				<div class="o_address_format"> <!-- reprise du standard  -->
				    <field name="di_company_country_code" attrs="{'invisible': 1 }"/>
				    <field name="street" placeholder="Street..." class="o_address_street"
				        attrs="{'readonly': [('type', '=', 'contact'),('parent_id', '!=', False)]}"/>
				    <field name="street2" placeholder="Street 2..." class="o_address_street"
				        attrs="{'readonly': [('type', '=', 'contact'),('parent_id', '!=', False)]}"/>
				    <field name="zip" placeholder="ZIP" class="o_address_zip"
				        attrs="{'readonly': [('type', '=', 'contact'),('parent_id', '!=', False)]
				        		,'invisible': [('di_company_country_code','!=', 'FR')]}"/>
				    <field name="city" placeholder="City" class="o_address_city"
				        attrs="{'readonly': [('type', '=', 'contact'),('parent_id', '!=', False)]}"/>
				    <field name="state_id" class="o_address_state" placeholder="State" options="{'no_open': True, 'no_quick_create': True}"
				        attrs="{'readonly': [('type', '=', 'contact'),('parent_id', '!=', False)]
				        		,'invisible': [('di_company_country_code','=', 'FR')]}" 
				        context="{'country_id': country_id, 'default_country_id': country_id, 'zip': zip}"
				        />
				    <field name="zip" placeholder="ZIP" class="o_address_zip"
				        attrs="{'readonly': [('type', '=', 'contact'),('parent_id', '!=', False)]
				        		,'invisible': [('di_company_country_code','=', 'FR')]}"/>
				    <field name="country_id" placeholder="Country" class="o_address_country" options='{"no_open": True, "no_create": True}'
				        attrs="{'readonly': [('type', '=', 'contact'),('parent_id', '!=', False)]}"/>
				</div>
			</xpath>                           
        </field>
    </record>
    <!-- modification formulaire adresse -->
    <record id="di_view_partner_address_form" model="ir.ui.view">
        <field name="name">di.res.partner.form.address</field>
        <field name="model">res.partner</field>
        <field name="inherit_id" ref="base.view_partner_address_form"/>
        <field eval="80" name="priority"/>
        <field name="arch" type="xml">
            <!-- ajout coche adresse par défaut -->
            <xpath expr="//group/group[2]" position="inside">
                <field
                    attrs="{'invisible':[('type', '!=', 'delivery'),('type', '!=', 'invoice')]}" name="di_default_address"/>
            </xpath>
 			<!-- masquage champ état + modif place ville/code postal dans le formulaire adresse -->
            <xpath expr="//group/group/div[2]" position="replace">
                <div class="o_address_format"> <!-- reprise du standard  -->
                	<field name="di_company_country_code" attrs="{'invisible': 1 }"/>
                    <field name="street" placeholder="Street..." class="o_address_street"/>
                    <field name="street2" placeholder="Street 2..." class="o_address_street"/>
                    <field name="zip" placeholder="ZIP" class="o_address_zip" attrs="{'invisible': [('di_company_country_code','!=', 'FR')]}"/>
                    <field name="city" placeholder="City" class="o_address_city"/>
                    <field name="state_id" class="o_address_state" placeholder="State" options="{'no_open': True, 'no_quick_create': True}"
                    	 context="{'default_country_id': country_id}"
                    	 attrs="{'invisible': [('di_company_country_code','=', 'FR')]}"
                   	/>
                    <field name="zip" placeholder="ZIP" class="o_address_zip" attrs="{'invisible': [('di_company_country_code','=', 'FR')]}"/>
                    <field name="country_id" placeholder="Country" class="o_address_country" options='{"no_open": True, "no_create": True}'/>
                </div>
            </xpath>                
        </field>
    </record>
    <!-- modification formulaire privé -->
    <record id="di_res_partner_view_form_private" model="ir.ui.view">
        <field name="name">di.res.partner.view.form.private</field>
        <field name="model">res.partner</field>
        <field name="inherit_id" ref="base.res_partner_view_form_private"/>
        <field eval="80" name="priority"/>
        <field name="arch" type="xml">
 			<!-- masquage champ état + modif place ville/code postal dans le formulaire privé -->
			<xpath expr="//div[@name='div_address']" position="replace">
				<div class="o_address_format" name="div_address"> <!-- reprise du standard  -->
					<field name="di_company_country_code" attrs="{'invisible': 1 }"/>
			        <field name="street" placeholder="Street..." class="o_address_street"/>
			        <field name="street2" placeholder="Street 2..." class="o_address_street"/>
			        <field name="zip" placeholder="ZIP" class="o_address_zip" attrs="{'invisible': [('di_company_country_code','!=', 'FR')]}"/>
			        <field name="city" placeholder="City" class="o_address_city"/>
			        <field name="state_id" class="o_address_state" placeholder="State" options="{'no_open': True, 'no_quick_create': True}" context="{'country_id': country_id, 'default_country_id': country_id, 'zip': zip}"/>
			        <field name="zip" placeholder="ZIP" class="o_address_zip" attrs="{'invisible': [('di_company_country_code','=', 'FR')]}"/>
			        <field name="country_id" placeholder="Country" class="o_address_country" options='{"no_open": True, "no_create": True}'/>
			   	</div>
			</xpath>               
        </field>
    </record>
    
</odoo>